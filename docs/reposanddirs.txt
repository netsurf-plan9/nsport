###############################
BUILD AND DIRECTORY OVERVIEW
###############################


REPOSITORIES

The Plan 9 port of Netsurf currently contains of the
umbrella respository 'nsport' and the following repos
from upstream Netsurf:

libcss
libdom
libhubbub
libnsbmp
libnsgif
libnslog
libnspsl
libnsutils
libparserutils
libutf8proc
libwapcaplet
libsvgtiny
nsgenbind
netsurf



There are a couple of other repos (libpencil, librosprite,
librufl, libsvgtiny, libnsfb) included from upstream Netsurf
that are not currently used in the Plan 9 netsurf build.

The 'nsport' repo contains a script 'fetch' that will clone
all needed repos required compile the Plan 9 Netsurf port. See
README.md for an instruction on how to clone and compile
everything.



BUILD SYSTEM

There are Plan 9 mkfile's in the the 'src' directories
of all support libraries, as well as in browser directory.
There is also an umbrella mkfile in the top directory
(in the repo 'nsport') that will build all support libraries
and then the browser itself, just by issuing a single 'mk'.

After building all libraries and the browser, it is possible
to install the browser in the system, which is done from
the 'netsurf' directory. Installing will copy the browser
binary (8.nsfb for the 386 architecture) to /$objtype/bin
(e.g. /386/bin/nsfb) and will also create a folder
/sys/lib/netsurf and put runtime files (web pages, css-files,
fonts etc.) in that folder.

Compiling the project will generate a lot of object files
(i.e. filename.8), libararies (i.e. filename.8.a) and the
executable (8.nsfb). If compiling for another architecture
the '8' will be another number/letter.

Note that both the building and cleaning only works on
the set $objtype. To build/clean for multiple architectures,
reapeat with different $objtype.


DIRECTORIES

libxxxxxx/

Support libraries that are more or less parts of Netsurf.
You will find their version numbers in their Makefile files.

The Gmake makefiles (Makefile) are not used in the
build process on Plan 9. Nor are test-suits included
in the build at this time. All files contained in the
upstream source are kept, even if they are not used in
the Plan 9 build at the moment.

Generally, 'mkfiles' are found in 'src' diretories in
each library. There are fewer 'mkfile' than the original
Makefile:s. Object files and library files are built in
the same directory as their source, and not moved around
during the build process. In the final linking of the browser,
the compiled libraries (*.8.a) will be loaded from each
library directory respectively.

Note that the mkfile's are kept simple and don't fully
represent all possible dependencies between files,
especially regarding header files and between libraries.
If you update a file in a library, you are expected to
rebuild at least that library before rebuilding the browser.


netsurf/

Main directory of the browser. The executable will be here after
building. Also contains the 'mkfile' for installing the browser
in the system.

posix/

Extra posix functions not in APE (The Ansi/Posix Environment)
of Plan 9. Also some other files, not part of the netsurf source,
that needed to go somewhere. This directory might go away in
the future, if functions are incorporated into upstream APE.

genfiles/

Some files (e.g. XXX.inc and YYY.inc) are in the original
generated by perl scripts during the build process.
To avoid a depency on perl, these are copied in their
generated form, and have to be manually updated if needed.
The same goes for some gen_* files that are the output of
flex/bison, that was not compatible with lex/yacc.


RUNNING

If you don't want (or have permissions) to install outside
your home/build directory, it is possible to run the script
'prepns' in the netsurf directory, which will bind the runtime
resources in the process' namespace only, after which it is
possible to run the executable (e.g. 8.nsfb) from the netsurf
directory directly.
 
The installed browser executable is called 'netsurf' and expects
its runtime to be in /sys/lib/netsurf. In order to access
resources over the network, you must have 'webfs' running before
you start the browser.

To access files in the file system, you have to use
absolute paths such as "file:///usr/glenda/file.html".

The browser should not emit a lot of output on stdout or
stderr under normal operation, but it is possible turn on
debug information from the browser by running it with
the verbose option (-v).
